!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("@angular/core")):"function"==typeof define&&define.amd?define("ng-lazyload-image",["exports","rxjs","rxjs/operators","@angular/common","@angular/core"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ng-lazyload-image"]={},e.rxjs,e.rxjs.operators,e.ng.common,e.ng.core)}(this,(function(e,t,n,r,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function s(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}Object.create;function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}Object.create;function c(e){return Boolean(e.parentElement&&"picture"===e.parentElement.nodeName.toLowerCase())}function l(e){return"img"===e.nodeName.toLowerCase()}function p(e,t,n,r){return l(e)?n&&"srcset"in e?e.srcset=t:e.src=t:e.style.backgroundImage=r+" url('"+t+"')",e}function f(e){return function(t){for(var n=t.parentElement.getElementsByTagName("source"),r=0;r<n.length;r++){var o=n[r].getAttribute(e);o&&("srcset"in n[r]?n[r].srcset=o:n[r].src=o)}}}var g=f("defaultImage"),h=f("lazyLoad"),d=f("errorImage");function m(e){return function(t,n,r,o){l(t)&&c(t)&&e(t),n&&p(t,n,r,o)}}var b=m(g),y=m(h),v=m(d),I=function(){function e(){this.navigator="undefined"!=typeof window?window.navigator:void 0}return e.prototype.setPlatformId=function(e){this.platformId=e},e.prototype.onDestroy=function(e){},e.prototype.onAttributeChange=function(e){},e}(),S="ng-lazyloaded",k="ng-lazyloading",w="ng-failed-lazyloaded";function C(e,t){e.className=e.className.replace(t,"")}function L(e,t){e.className.includes(t)||(e.className+=" "+t)}var O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.setup=function(e){var t,n;b(e.element,e.defaultImagePath,e.useSrcset,e.cssBackgroundPrefix),L(e.element,k),t=e.element,n=S,t.className&&t.className.includes(n)&&C(e.element,S)},t.prototype.finally=function(e){L(e.element,S),C(e.element,k)},t.prototype.loadImage=function(e){if(this.skipLazyLoading(e))return[e.imagePath];var t,n=e.element,r=e.useSrcset,o=e.imagePath,i=e.decode,s=e.cssBackgroundPrefix;if(l(n)&&c(n)){var a=n.parentNode.cloneNode(!0);t=a.getElementsByTagName("img")[0],h(t),p(t,o,r,s)}else t=new Image,l(n)&&n.referrerPolicy&&(t.referrerPolicy=n.referrerPolicy),l(n)&&n.sizes&&(t.sizes=n.sizes),r&&"srcset"in t?t.srcset=o:t.src=o;return i&&t.decode?t.decode().then((function(){return o})):new Promise((function(e,n){t.onload=function(){return e(o)},t.onerror=function(){return n(null)}}))},t.prototype.setErrorImage=function(e,t){var n=t.element,r=t.useSrcset,o=t.errorImagePath,i=t.cssBackgroundPrefix;v(n,o,r,i),L(n,w)},t.prototype.setLoadedImage=function(e,t){var n=t.element,r=t.useSrcset,o=t.cssBackgroundPrefix;y(n,e,r,o)},t.prototype.isDisabled=function(){return r.isPlatformServer(this.platformId)&&!this.isBot()},t.prototype.skipLazyLoading=function(e){return this.isBot(e)},t.prototype.isBot=function(e){var t;return!!(null===(t=this.navigator)||void 0===t?void 0:t.userAgent)&&/googlebot|bingbot|yandex|baiduspider|facebookexternalhit|twitterbot|rogerbot|linkedinbot|embedly|quora\ link\ preview|showyoubot|outbrain|pinterest\/0\.|pinterestbot|slackbot|vkShare|W3C_Validator|whatsapp|duckduckbot/i.test(this.navigator.userAgent)},t}(I),x=function(e){function r(){var n=e.apply(this,u(arguments))||this;return n.observers=new WeakMap,n.intersectionSubject=new t.Subject,n.uniqKey={},n}return s(r,e),r.prototype.getObservable=function(e){var r=this;if(this.skipLazyLoading(e))return t.of({isIntersecting:!0});if(e.customObservable)return e.customObservable;var o=e.scrollContainer||this.uniqKey,i={root:e.scrollContainer||null};e.offset&&(i.rootMargin=e.offset+"px");var s=this.observers.get(o);return s||(s=new IntersectionObserver((function(e){return r.loadingCallback(e)}),i),this.observers.set(o,s)),s.observe(e.element),t.Observable.create((function(t){var o=r.intersectionSubject.pipe(n.filter((function(t){return t.target===e.element}))).subscribe(t);return function(){o.unsubscribe(),s.unobserve(e.element)}}))},r.prototype.isVisible=function(e){return e.isIntersecting},r.prototype.loadingCallback=function(e){var t=this;e.forEach((function(e){return t.intersectionSubject.next(e)}))},r}(O);var P=new o.InjectionToken("LazyLoadImageHooks"),j=function(){function e(e,n,r,i){this.onStateChange=new o.EventEmitter,this.elementRef=e,this.ngZone=n,this.propertyChanges$=new t.ReplaySubject,this.hooks=i,this.hooks.setPlatformId(r),this.uid=Math.random().toString(36).substr(2,9)}return e.prototype.ngOnChanges=function(){!0!==this.debug||this.debugSubscription||(this.debugSubscription=this.onStateChange.subscribe((function(e){return console.log(e)}))),this.propertyChanges$.next({element:this.elementRef.nativeElement,imagePath:this.lazyImage,defaultImagePath:this.defaultImage,errorImagePath:this.errorImage,useSrcset:this.useSrcset,cssBackgroundPrefix:this.cssBackgroundPrefix,offset:this.offset?0|this.offset:0,scrollContainer:this.scrollTarget,customObservable:this.customObservable,decode:this.decode,onStateChange:this.onStateChange,id:this.uid})},e.prototype.ngAfterContentInit=function(){var e=this;if(this.hooks.isDisabled())return null;this.ngZone.runOutsideAngular((function(){e.loadSubscription=e.propertyChanges$.pipe(n.tap((function(t){return e.hooks.onAttributeChange(t)})),n.tap((function(e){return e.onStateChange.emit({reason:"setup"})})),n.tap((function(t){return e.hooks.setup(t)})),n.switchMap((function(r){return r.imagePath?e.hooks.getObservable(r).pipe(function(e,r){return function(o){return o.pipe(n.tap((function(e){return r.onStateChange.emit({reason:"observer-emit",data:e})})),n.filter((function(t){return e.isVisible(t,r)})),n.take(1),n.tap((function(){return r.onStateChange.emit({reason:"start-loading"})})),n.mergeMap((function(){return e.loadImage(r)})),n.tap((function(){return r.onStateChange.emit({reason:"mount-image"})})),n.tap((function(t){return e.setLoadedImage(t,r)})),n.tap((function(){return r.onStateChange.emit({reason:"loading-succeeded"})})),n.map((function(){return!0})),n.catchError((function(n){return r.onStateChange.emit({reason:"loading-failed",data:n}),e.setErrorImage(n,r),t.of(!1)})),n.tap((function(){r.onStateChange.emit({reason:"finally"}),e.finally(r)})))}}(e.hooks,r)):t.never()}))).subscribe({next:function(){return null}})}))},e.prototype.ngOnDestroy=function(){var e,t,r=this;this.propertyChanges$.pipe(n.take(1)).subscribe({next:function(e){return r.hooks.onDestroy(e)}}).unsubscribe(),null===(e=this.loadSubscription)||void 0===e||e.unsubscribe(),null===(t=this.debugSubscription)||void 0===t||t.unsubscribe()},e}();j.decorators=[{type:o.Directive,args:[{selector:"[lazyLoad]"}]}],j.ctorParameters=function(){return[{type:o.ElementRef},{type:o.NgZone},{type:Object,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]},{type:I,decorators:[{type:o.Inject,args:[P]}]}]},j.propDecorators={lazyImage:[{type:o.Input,args:["lazyLoad"]}],defaultImage:[{type:o.Input}],errorImage:[{type:o.Input}],scrollTarget:[{type:o.Input}],customObservable:[{type:o.Input}],offset:[{type:o.Input}],useSrcset:[{type:o.Input}],cssBackgroundPrefix:[{type:o.Input}],decode:[{type:o.Input}],debug:[{type:o.Input}],onStateChange:[{type:o.Output}]};var E=function(){};E.decorators=[{type:o.NgModule,args:[{declarations:[j],exports:[j],providers:[{provide:P,useClass:x}]}]}];var z=function(){function e(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r}return e.fromElement=function(t){var n=t.getBoundingClientRect(),r=n.left,o=n.top,i=n.right,s=n.bottom;return 0===r&&0===o&&0===i&&0===s?e.empty:new e(r,o,i,s)},e.fromWindow=function(t){return new e(0,0,t.innerWidth,t.innerHeight)},e.prototype.inflate=function(e){this.left-=e,this.top-=e,this.right+=e,this.bottom+=e},e.prototype.intersectsWith=function(e){return e.left<this.right&&this.left<e.right&&e.top<this.bottom&&this.top<e.bottom},e.prototype.getIntersectionWith=function(t){var n=Math.max(this.left,t.left),r=Math.max(this.top,t.top),o=Math.min(this.right,t.right),i=Math.min(this.bottom,t.bottom);return o>=n&&i>=r?new e(n,r,o,i):e.empty},e}();z.empty=new z(0,0,0,0);var W=function(e){function r(){var n=e.apply(this,u(arguments))||this;return n.getWindow=function(){return window},n.scrollListeners=new WeakMap,n.getScrollListener=function(e){if(!e||"function"!=typeof e.addEventListener)return console.warn("`addEventListener` on "+e+" (scrollTarget) is not a function. Skipping this target"),t.empty();var r=n.scrollListeners.get(e);if(r)return r;var o=t.Observable.create((function(t){var n="scroll",r=function(e){return t.next(e)},o={passive:!0,capture:!1};return e.addEventListener(n,r,o),function(){return e.removeEventListener(n,r,o)}})),i=n.sampleObservable(o);return n.scrollListeners.set(e,i),i},n}return s(r,e),r.prototype.getObservable=function(e){return this.skipLazyLoading(e)?t.of("load"):e.customObservable?e.customObservable.pipe(n.startWith("")):e.scrollContainer?this.getScrollListener(e.scrollContainer):this.getScrollListener(this.getWindow())},r.prototype.isVisible=function(e,t){var n=z.fromElement(t.element);if(n===z.empty)return!1;var r=z.fromWindow(this.getWindow());if(n.inflate(t.offset),t.scrollContainer){var o=z.fromElement(t.scrollContainer).getIntersectionWith(r);return n.intersectsWith(o)}return n.intersectsWith(r)},r.prototype.sampleObservable=function(e,t){return e.pipe(n.sampleTime(100,t),n.share(),n.startWith(""))},r}(O);e.Hooks=I,e.IntersectionObserverHooks=x,e.LAZYLOAD_IMAGE_HOOKS=P,e.LazyLoadImageDirective=j,e.LazyLoadImageModule=E,e.ScrollHooks=W,e.SharedHooks=O,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-lazyload-image.umd.min.js.map